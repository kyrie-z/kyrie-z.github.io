<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/assets/blog/authors/joe.jpeg"/><link rel="stylesheet" href="/_next/static/css/fa58449823ab4344.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/1a36663c02865c1c.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-eab9dc47eafd4afc.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f374b534e356ecb9.js" async="" crossorigin=""></script><script src="/_next/static/chunks/647-b237105082792b4e.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-b3b901fbdca77438.js" async=""></script><title>为什么所有权很重要 | Zilong Zhou</title><meta name="description" content="A statically generated blog example using Next.js and Zilong Zhou."/><meta property="og:title" content="为什么所有权很重要 | Zilong Zhou"/><meta property="og:description" content="A statically generated blog example using Next.js and Zilong Zhou."/><meta property="og:image" content="http://localhost:3000/assets/blog/preview/cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="为什么所有权很重要 | Zilong Zhou"/><meta name="twitter:description" content="A statically generated blog example using Next.js and Zilong Zhou."/><meta name="twitter:image" content="http://localhost:3000/assets/blog/preview/cover.jpg"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="__className_aaf875"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">zzl Blog</a>.</h2><article class="mb-32"><h1 class="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">为什么所有权很重要</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/blog/authors/joe.jpeg" class="w-12 h-12 rounded-full mr-4" alt="Joe Haddad"/><div class="text-xl font-bold">Joe Haddad</div></div></div><div class="mb-8 md:mb-16 sm:mx-0"><div class="sm:mx-0"></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/blog/authors/joe.jpeg" class="w-12 h-12 rounded-full mr-4" alt="Joe Haddad"/><div class="text-xl font-bold">Joe Haddad</div></div></div><div class="mb-12 text-right text-lg"><time dateTime="2023-06-07T05:15:20.114Z">June	7, 2023</time></div></div><div class="max-w-4xl mx-auto"><div class="markdown-styles_markdown__ORfR8"><p>WWDC 2023 中发布了 Swift 5.9，带来了许多新特性。大家都普遍对宏非常感兴趣，然而所有权的特性并没有引起很多关注。不过我认为这是 Swift 迭代多年以来的一个非常重要的特性，有了这个特性之后 Swift 将更具表达力，对代码有更准确的控制。</p>
<p>让我们来一起探索一下。</p>
<h2>值类型</h2>
<p>在讨论什么是所有权之前，我们先来说说值类型。</p>
<p>Swift 有两种类型：<strong>引用类型</strong>和<strong>值类型</strong>。</p>
<p>引用类型采用了引用计数来维护它的生命周期，并且是分配在堆内存的。它们在函数间传递时也采用了引用语义。通常来说，你可以在其中维护一些底层资源，并且在 <code>init</code> 和 <code>deinit</code> 方法中管理它们。比如当你写出下面这样的代码时：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">class</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Foo</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span>
<span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> x </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Foo</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span><span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> y </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> x</span></code></pre></pre>
<p>它会创建一个指向 <code>x</code> 的新引用，但没有新的对象被创建。</p>
<p>但值类型的每个变量却是独立的值，在 Swift 5.9 之前的版本，它们会在赋值的时候发生拷贝。比如上面相同的代码，<code>x</code> 的内容会被拷贝到 <code>y</code>，它们表示的就会是不同的东西了。</p>
<p>像 C++ 和 Rust 这样的语言只有值类型，但你可以通过 RAII 等特性自己实现引用类型。</p>
<h2>平凡类型</h2>
<p>在 C++ 中有一个概念叫做平凡类型，它们需要具有<a href="https://en.cppreference.com/w/cpp/language/copy_constructor#Trivial_copy_constructor">平凡复制</a>、<a href="https://en.cppreference.com/w/cpp/language/move_constructor#Trivial_move_constructor">平凡移动</a> 构造函数，以及<a href="https://en.cppreference.com/w/cpp/language/destructor#Trivial_destructor">平凡析构函数</a>。也就是说它们不可以是用户定义的。</p>
<p>在 Swift 5.9 之前，所有的值类型都是平凡类型。当你拷贝它们时，它们的内存字节会被直接拷贝到新的位置，不会有其他事情发生。不过有一点不同的是，value witness 函数可能会被执行，所以结构体里的引用类型成员的引用计数会被增加（不过这也不是我们可以控制的行为）。</p>
<p>由于 Swift 中的值类型都是平凡类型，所以它们不能用来实现 RAII，并且也是设计如此的。
像 <code>CGRect</code>、<code>Date</code> 和 <code>Character</code> 这些类型，它们都是表示值的，而不是资源。我们也不需要关心如何释放它们所管理的资源，毕竟它们根本不会手动申请任何资源。</p>
<p>值类型中的引用类型成员是被特殊处理的，编译器会保证它们会被正确释放。比如 <code>String</code> 底层会有额外的堆内存 buffer 来存储可变长度的内容，这些 buffer 都是类实现的，因此也可以通过引用计数来正确管理。</p>
<h2>一个常见的问题</h2>
<p>引用类型很棒，你可以分配管理你自己的资源，Swift 也可以在合适的时机释放它们。但引用类型也有缺点：所有的对象都是分配在堆上的，在一些性能敏感的场景，大量的堆内存分配会带来严重的开销。</p>
<p>让我们来看一个实际的例子：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">struct</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> fd</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Int</span><span>
</span>
<span>  </span><span class="token" style="color:hsl(301, 63%, 40%)">init</span><span class="token" style="color:hsl(221, 87%, 60%)">?</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>filePath</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">String</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(301, 63%, 40%)">guard</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> fd </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">try</span><span class="token" style="color:hsl(221, 87%, 60%)">?</span><span> </span><span class="token" style="color:hsl(221, 87%, 60%)">openFile</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>at</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> filePath</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">else</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>      </span><span class="token" style="color:hsl(301, 63%, 40%)">return</span><span> </span><span class="token nil" style="color:hsl(35, 99%, 36%)">nil</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span>    </span><span class="token" style="color:hsl(301, 63%, 40%)">self</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span>fd </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> fd
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span>
<span>  </span><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token omit" style="color:hsl(301, 63%, 40%)">_</span><span> data</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Data</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span>
<span>  </span><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">close</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<p><code>FileDescriptor</code> 所持有的资源并不仅仅是一个整数值，我们也绝对不希望为了引用计数的资源管理而引入堆内存分配。然而使用 struct 意味着你需要手动处理资源的释放问题，更糟糕的是，如果你拷贝了这个值，我们对资源就完全失去控制了：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> handleToFileA </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">try</span><span class="token" style="color:hsl(221, 87%, 60%)">!</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>filePath</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token string-literal" style="color:hsl(119, 34%, 47%)">&quot;/path/to/a&quot;</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span>
<span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> anotherHandleToFileA </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> handleToFileA
</span><span>anotherHandleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">close</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span>
<span>handleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">...</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// 💥 BOOM!</span></code></pre></pre>
<p>如此来看，struct 管理这类资源是完全不现实的了。</p>
<h2>Rust 是如何解决这个问题的</h2>
<p>我们会发现，其实换成 Rust 之后问题就迎刃而解了。为什么呢？</p>
<p>首先，Rust 的值类型不一定要是平凡类型，它们可以有自己的析构函数：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-rust" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">impl</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Drop</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">for</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">OwnedFd</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token attribute" style="color:hsl(35, 99%, 36%)">#[inline]</span><span>
</span><span>    </span><span class="token" style="color:hsl(301, 63%, 40%)">fn</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">drop</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token" style="color:hsl(301, 63%, 40%)">mut</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">self</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>        </span><span class="token" style="color:hsl(301, 63%, 40%)">unsafe</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>            </span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> _ </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="-opacity:0.8">libc</span><span class="token" style="-opacity:0.8;color:hsl(230, 8%, 24%)">::</span><span class="token" style="color:hsl(221, 87%, 60%)">close</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(301, 63%, 40%)">self</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span>fd</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span class="token" style="color:hsl(230, 8%, 24%)">;</span><span>
</span><span>        </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<p>其次，所有用户定义的类型默认都是不可拷贝的，它们在赋值时只能被移动：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-rust" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> handle_to_file_a </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="color:hsl(221, 87%, 60%)">acquire_fd</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span class="token" style="color:hsl(230, 8%, 24%)">;</span><span>
</span>
<span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> another_handle_to_file_a </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> handle_to_file_a</span><span class="token" style="color:hsl(230, 8%, 24%)">;</span><span> </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// note: value moved here</span><span>
</span><span></span><span class="token" style="color:hsl(221, 87%, 60%)">drop</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>another_handle_to_file_a</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span class="token" style="color:hsl(230, 8%, 24%)">;</span><span>
</span>
<span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> _ </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> handle_to_file_a</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">is_terminal</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span class="token" style="color:hsl(230, 8%, 24%)">;</span><span> </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// error: borrow of moved value: `handle_to_file_a`</span></code></pre></pre>
<p>最后，编译器会在编译时检查变量的生命周期。就像上面的代码所示，如果你使用了一个被移动过的变量，它会在编译时产生错误。</p>
<p>虽然 Rust 中所有的类型都是值类型，我们仍然可以把它们分为 3 类：</p>
<ol>
<li><strong>平凡类型：</strong> 这类类型可以按位拷贝，它们实现了 <code>Copy</code> 这个 trait。赋值时，它们会被隐式拷贝，而不是被移动。例子有 <code>i32</code>、<code>Duration</code> 等。</li>
<li><strong>可复制类型：</strong> 它们实现了 <code>Clone</code> trait，从而可以被显式地复制。复制之后，新的值可能表示同一个东西，也可能表示另外一个完全不同的东西，这取决于类型的语义。例子有 <code>String</code>、<code>Arc</code> 等。</li>
<li><strong>独占类型：</strong> 它们不可以被拷贝或者复制。例如 <code>File</code>、<code>Box&lt;T&gt;</code> (当 <code>T</code> 没有实现 <code>Clone</code> 时) 等。</li>
</ol>
<p>这些几乎覆盖了所有可能遇到的情况，soundness 也是能被编译器保证的。</p>
<p>Rust 另外一个非常好的点是所有的值默认都是移动语义的。除了一些罕见的场景（比如自引用类型），使用移动语义不会让你犯错误。在你认为安全且必要时，你可以逐步添加对 <code>Copy</code> 和 <code>Clone</code> 的支持。</p>
<p>所有这些规则组成了 Rust 这个独特的特性：<strong><a href="https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html">所有权</a></strong>。</p>
<h2>Swift 中的所有权</h2>
<p>Swift 5.9 引入了「<strong><a href="https://github.com/apple/swift-evolution/blob/main/proposals/0390-noncopyable-structs-and-enums.md">不可拷贝类型</a></strong>」，同时隐含了独占所有权的概念。表示底层资源的值类型适合被标记为不可拷贝，这样我们就能防止不经意地拷贝上面说的 <code>FileDescriptor</code> 了。并且因为它的所有权是独占的，在变量退出作用域时也可以被安全地释放掉。因此你可以为这类值类型添加 <code>deinit</code> 方法。</p>
<p>要让一个类型是不可拷贝的，只需要添加一个 <code>~Copyable</code> 标记即可：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">struct</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(221, 87%, 60%)">~</span><span class="token" style="color:hsl(35, 99%, 36%)">Copyable</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span>
<span>  consuming </span><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">close</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<p><code>consuming</code> 修饰符会使 <code>close</code> 方法消费（移动）掉这个对象。这样，下面的代码就是无效的了：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> handleToFileA </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> </span><span class="token" style="color:hsl(301, 63%, 40%)">try</span><span class="token" style="color:hsl(221, 87%, 60%)">!</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>filePath</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token string-literal" style="color:hsl(119, 34%, 47%)">&quot;/path/to/a&quot;</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span>
<span></span><span class="token" style="color:hsl(301, 63%, 40%)">let</span><span> anotherHandleToFileA </span><span class="token" style="color:hsl(221, 87%, 60%)">=</span><span> handleToFileA
</span><span>anotherHandleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">close</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span>
<span>handleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">...</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// error: &#x27;handleToFileA&#x27; used after consume</span></code></pre></pre>
<p>将一个不可拷贝类型的变量赋给另一个变量时，值会发生移动。但有时你可能不想直接消费掉这个对象，只是想暂时使用一下。这就需要用到“借用”了，可以通过将一个方法标记为 <code>borrowing</code> 来实现：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">struct</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(221, 87%, 60%)">~</span><span class="token" style="color:hsl(35, 99%, 36%)">Copyable</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span>
<span>  borrowing </span><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token omit" style="color:hsl(301, 63%, 40%)">_</span><span> data</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">Data</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span>
<span></span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// It&#x27;s ok to do this multiple times:</span><span>
</span><span>handleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">...</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span><span>handleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">...</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span>
</span><span>handleToFileA</span><span class="token" style="color:hsl(230, 8%, 24%)">.</span><span class="token" style="color:hsl(221, 87%, 60%)">write</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token" style="color:hsl(221, 87%, 60%)">...</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span></code></pre></pre>
<p>实际上你并不需要显式的 <code>close</code> 方法，不可拷贝类型由于有 <code>deinit</code> 方法，你可以直接在那里释放资源，从而实现类似 RAII 的效果：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">struct</span><span> </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> </span><span class="token" style="color:hsl(221, 87%, 60%)">~</span><span class="token" style="color:hsl(35, 99%, 36%)">Copyable</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span>
<span>  </span><span class="token" style="color:hsl(301, 63%, 40%)">deinit</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// Called when the file descriptor leaves the scope.</span><span>
</span><span>    </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 8%, 24%)">}</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<p>方法如果有 <code>consuming</code> 的参数，同样也会取走这个变量的所有权：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">flushAndClose</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span class="token omit" style="color:hsl(301, 63%, 40%)">_</span><span> fd</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> consuming </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// ...</span><span>
</span>
<span>  </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// `deinit` of `fd` is called here.</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<p>你不能够取走借用变量的所有权：</p>
<pre><pre class="text-sm" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-swift" style="background:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(301, 63%, 40%)">func</span><span> </span><span class="token function-definition" style="color:hsl(221, 87%, 60%)">appendSomething</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>to fd</span><span class="token" style="color:hsl(230, 8%, 24%)">:</span><span> borrowing </span><span class="token" style="color:hsl(35, 99%, 36%)">FileDescriptor</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 8%, 24%)">{</span><span>
</span><span>  </span><span class="token" style="color:hsl(221, 87%, 60%)">flushAndClose</span><span class="token" style="color:hsl(230, 8%, 24%)">(</span><span>fd</span><span class="token" style="color:hsl(230, 8%, 24%)">)</span><span> </span><span class="token" style="color:hsl(230, 4%, 64%);font-style:italic">// error: &#x27;fd&#x27; has guaranteed ownership but was consumed</span><span>
</span><span></span><span class="token" style="color:hsl(230, 8%, 24%)">}</span></code></pre></pre>
<h2>总结</h2>
<p>所有权是一个非常棒的特性，它能够让我们写出更加内存安全的代码，同时又不需要引入额外的开销。我们称这类特性为零开销抽象，它们在系统编程中至关重要。尽管 Swift 没有强制要求我们使用所有权特性，但我们仍然应该了解它，并尽可能利用它写出更好的代码。</p></div></div></article></div></main></div><script src="/_next/static/chunks/webpack-eab9dc47eafd4afc.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/fa58449823ab4344.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/1a36663c02865c1c.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nc:I[8955,[],\"\"]\n9:[\"slug\",\"why-ownership-matters.zh_CN\",\"d\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fa58449823ab4344.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"u2GPBZ01wh5YvSkkIbJmK\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/why-ownership-matters.zh_CN\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"why-ownership-matters.zh_CN\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"why-ownership-matters.zh_CN\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"why-ownership-matters.zh_CN\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/1a36663c02865c1c.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/favicon/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/favicon/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon/safari-pinned-tab.svg\",\"color\":\"#000000\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon/favicon.ico\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-config\",\"content\":\"/favicon/browserconfig.xml\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]}]]}],null]],\"initialHead\":[false,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[5250,[\"647\",\"static/chunks/647-b237105082792b4e.js\",\"333\",\"static/chunks/app/posts/%5Bslug%5D/page-b3b901fbdca77438.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"main\",null,{\"children\":[false,[\"$\",\"div\",null,{\"className\":\"container mx-auto px-5\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8\",\"children\":[[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"hover:underline\",\"children\":\"zzl Blog\"}],\".\"]}],[\"$\",\"article\",null,{\"className\":\"mb-32\",\"children\":[[[\"$\",\"h1\",null,{\"className\":\"text-5xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left\",\"children\":\"为什么所有权很重要\"}],[\"$\",\"div\",null,{\"className\":\"hidden md:block md:mb-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/assets/blog/authors/joe.jpeg\",\"className\":\"w-12 h-12 rounded-full mr-4\",\"alt\":\"Joe Haddad\"}],[\"$\",\"div\",null,{\"className\":\"text-xl font-bold\",\"children\":\"Joe Haddad\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mb-8 md:mb-16 sm:mx-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"sm:mx-0\",\"children\":null}]}],[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"block md:hidden mb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"img\",null,{\"src\":\"/assets/blog/authors/joe.jpeg\",\"className\":\"w-12 h-12 rounded-full mr-4\",\"alt\":\"Joe Haddad\"}],[\"$\",\"div\",null,{\"className\":\"text-xl font-bold\",\"children\":\"Joe Haddad\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mb-12 text-right text-lg\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2023-06-07T05:15:20.114Z\",\"children\":\"June\\t7, 2023\"}]}]]}]],[\"$\",\"div\",null,{\"className\":\"max-w-4xl mx-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"markdown-styles_markdown__ORfR8\",\"children\":[[\"$\",\"p\",\"p-0\",{\"children\":\"WWDC 2023 中发布了 Swift 5.9，带来了许多新特性。大家都普遍对宏非常感兴趣，然而所有权的特性并没有引起很多关注。不过我认为这是 Swift 迭代多年以来的一个非常重要的特性，有了这个特性之后 Swift 将更具表达力，对代码有更准确的控制。\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"让我们来一起探索一下。\"}],\"\\n\",[\"$\",\"h2\",\"h2-0\",{\"children\":\"值类型\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"在讨论什么是所有权之前，我们先来说说值类型。\"}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":[\"Swift 有两种类型：\",[\"$\",\"strong\",\"strong-0\",{\"children\":\"引用类型\"}],\"和\",[\"$\",\"strong\",\"strong-1\",{\"children\":\"值类型\"}],\"。\"]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"引用类型采用了引用计数来维护它的生命周期，并且是分配在堆内存的。它们在函数间传递时也采用了引用语义。通常来说，你可以在其中维护一些底层资源，并且在 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"init\"}],\" 和 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"deinit\"}],\" 方法中管理它们。比如当你写出下面这样的代码时：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"class\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Foo\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" x \"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Foo\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" y \"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" x\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":[\"它会创建一个指向 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"x\"}],\" 的新引用，但没有新的对象被创建。\"]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":[\"但值类型的每个变量却是独立的值，在 Swift 5.9 之前的版本，它们会在赋值的时候发生拷贝。比如上面相同的代码，\",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"x\"}],\" 的内容会被拷贝到 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"y\"}],\"，它们表示的就会是不同的东西了。\"]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"像 C++ 和 Rust 这样的语言只有值类型，但你可以通过 RAII 等特性自己实现引用类型。\"}],\"\\n\",[\"$\",\"h2\",\"h2-1\",{\"children\":\"平凡类型\"}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":[\"在 C++ 中有一个概念叫做平凡类型，它们需要具有\",[\"$\",\"a\",\"a-0\",{\"href\":\"https://en.cppreference.com/w/cpp/language/copy_constructor#Trivial_copy_constructor\",\"children\":\"平凡复制\"}],\"、\",[\"$\",\"a\",\"a-1\",{\"href\":\"https://en.cppreference.com/w/cpp/language/move_constructor#Trivial_move_constructor\",\"children\":\"平凡移动\"}],\" 构造函数，以及\",[\"$\",\"a\",\"a-2\",{\"href\":\"https://en.cppreference.com/w/cpp/language/destructor#Trivial_destructor\",\"children\":\"平凡析构函数\"}],\"。也就是说它们不可以是用户定义的。\"]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":\"在 Swift 5.9 之前，所有的值类型都是平凡类型。当你拷贝它们时，它们的内存字节会被直接拷贝到新的位置，不会有其他事情发生。不过有一点不同的是，value witness 函数可能会被执行，所以结构体里的引用类型成员的引用计数会被增加（不过这也不是我们可以控制的行为）。\"}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":[\"由于 Swift 中的值类型都是平凡类型，所以它们不能用来实现 RAII，并且也是设计如此的。\\n像 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"CGRect\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Date\"}],\" 和 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Character\"}],\" 这些类型，它们都是表示值的，而不是资源。我们也不需要关心如何释放它们所管理的资源，毕竟它们根本不会手动申请任何资源。\"]}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":[\"值类型中的引用类型成员是被特殊处理的，编译器会保证它们会被正确释放。比如 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"String\"}],\" 底层会有额外的堆内存 buffer 来存储可变长度的内容，这些 buffer 都是类实现的，因此也可以通过引用计数来正确管理。\"]}],\"\\n\",[\"$\",\"h2\",\"h2-2\",{\"children\":\"一个常见的问题\"}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":\"引用类型很棒，你可以分配管理你自己的资源，Swift 也可以在合适的时机释放它们。但引用类型也有缺点：所有的对象都是分配在堆上的，在一些性能敏感的场景，大量的堆内存分配会带来严重的开销。\"}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":\"让我们来看一个实际的例子：\"}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"struct\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" fd\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Int\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"init\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"?\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"filePath\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"String\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"guard\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" fd \"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"try\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"?\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"openFile\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"at\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" filePath\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"else\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"      \"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"return\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"token nil\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"nil\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"self\"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"fd \"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" fd\\n\"]}],[\"$\",\"span\",\"code-segement61\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement62\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement63\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement65\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement66\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement67\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement68\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement69\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement70\",{\"className\":\"token omit\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"_\"]}],[\"$\",\"span\",\"code-segement71\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" data\"]}],[\"$\",\"span\",\"code-segement72\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement73\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement74\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Data\"]}],[\"$\",\"span\",\"code-segement75\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement76\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement77\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement78\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement79\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement80\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement81\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement82\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement83\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement84\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement86\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement87\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement88\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement89\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"code-segement90\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement91\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement92\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement93\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement94\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement95\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement96\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement97\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement98\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement99\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement100\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement101\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement102\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":[[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"FileDescriptor\"}],\" 所持有的资源并不仅仅是一个整数值，我们也绝对不希望为了引用计数的资源管理而引入堆内存分配。然而使用 struct 意味着你需要手动处理资源的释放问题，更糟糕的是，如果你拷贝了这个值，我们对资源就完全失去控制了：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handleToFileA \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"try\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"!\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"filePath\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"token string-literal\",\"style\":{\"color\":\"hsl(119, 34%, 47%)\"},\"children\":[\"\\\"/path/to/a\\\"\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" anotherHandleToFileA \"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handleToFileA\\n\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"anotherHandleToFileA\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"handleToFileA\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"...\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// 💥 BOOM!\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":\"如此来看，struct 管理这类资源是完全不现实的了。\"}],\"\\n\",[\"$\",\"h2\",\"h2-3\",{\"children\":\"Rust 是如何解决这个问题的\"}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"我们会发现，其实换成 Rust 之后问题就迎刃而解了。为什么呢？\"}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":\"首先，Rust 的值类型不一定要是平凡类型，它们可以有自己的析构函数：\"}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"impl\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Drop\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"for\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"OwnedFd\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token attribute\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"#[inline]\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"fn\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"drop\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"\u0026\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"mut\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"self\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"unsafe\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"            \"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" _ \"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"Opacity\":\"0.8\"},\"children\":[\"libc\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"token\",\"style\":{\"Opacity\":\"0.8\",\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"::\"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"self\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"fd\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"        \"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":\"其次，所有用户定义的类型默认都是不可拷贝的，它们在赋值时只能被移动：\"}],\"\\n\",[\"$\",\"pre\",\"pre-4\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handle_to_file_a \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"acquire_fd\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" another_handle_to_file_a \"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handle_to_file_a\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// note: value moved here\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"drop\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"another_handle_to_file_a\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" _ \"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handle_to_file_a\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"is_terminal\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\";\"]}],[\"$\",\"span\",\"code-segement37\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement38\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// error: borrow of moved value: `handle_to_file_a`\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":\"最后，编译器会在编译时检查变量的生命周期。就像上面的代码所示，如果你使用了一个被移动过的变量，它会在编译时产生错误。\"}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"children\":\"虽然 Rust 中所有的类型都是值类型，我们仍然可以把它们分为 3 类：\"}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"平凡类型：\"}],\" 这类类型可以按位拷贝，它们实现了 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Copy\"}],\" 这个 trait。赋值时，它们会被隐式拷贝，而不是被移动。例子有 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"i32\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Duration\"}],\" 等。\"]}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"可复制类型：\"}],\" 它们实现了 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Clone\"}],\" trait，从而可以被显式地复制。复制之后，新的值可能表示同一个东西，也可能表示另外一个完全不同的东西，这取决于类型的语义。例子有 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"String\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Arc\"}],\" 等。\"]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[[\"$\",\"strong\",\"strong-0\",{\"children\":\"独占类型：\"}],\" 它们不可以被拷贝或者复制。例如 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"File\"}],\"、\",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Box\u003cT\u003e\"}],\" (当 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"T\"}],\" 没有实现 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Clone\"}],\" 时) 等。\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"children\":\"这些几乎覆盖了所有可能遇到的情况，soundness 也是能被编译器保证的。\"}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"children\":[\"Rust 另外一个非常好的点是所有的值默认都是移动语义的。除了一些罕见的场景（比如自引用类型），使用移动语义不会让你犯错误。在你认为安全且必要时，你可以逐步添加对 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Copy\"}],\" 和 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"Clone\"}],\" 的支持。\"]}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"children\":[\"所有这些规则组成了 Rust 这个独特的特性：\",[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"https://doc.rust-lang.org/book/ch04-01-what-is-ownership.html\",\"children\":\"所有权\"}]}],\"。\"]}],\"\\n\",[\"$\",\"h2\",\"h2-4\",{\"children\":\"Swift 中的所有权\"}],\"\\n\",[\"$\",\"p\",\"p-24\",{\"children\":[\"Swift 5.9 引入了「\",[\"$\",\"strong\",\"strong-0\",{\"children\":[\"$\",\"a\",\"a-0\",{\"href\":\"https://github.com/apple/swift-evolution/blob/main/proposals/0390-noncopyable-structs-and-enums.md\",\"children\":\"不可拷贝类型\"}]}],\"」，同时隐含了独占所有权的概念。表示底层资源的值类型适合被标记为不可拷贝，这样我们就能防止不经意地拷贝上面说的 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"FileDescriptor\"}],\" 了。并且因为它的所有权是独占的，在变量退出作用域时也可以被安全地释放掉。因此你可以为这类值类型添加 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"deinit\"}],\" 方法。\"]}],\"\\n\",[\"$\",\"p\",\"p-25\",{\"children\":[\"要让一个类型是不可拷贝的，只需要添加一个 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"~Copyable\"}],\" 标记即可：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-5\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"struct\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"~\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Copyable\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  consuming \"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-26\",{\"children\":[[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"consuming\"}],\" 修饰符会使 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"close\"}],\" 方法消费（移动）掉这个对象。这样，下面的代码就是无效的了：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-6\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handleToFileA \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"try\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"!\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"filePath\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"token string-literal\",\"style\":{\"color\":\"hsl(119, 34%, 47%)\"},\"children\":[\"\\\"/path/to/a\\\"\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"let\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" anotherHandleToFileA \"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"=\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" handleToFileA\\n\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"anotherHandleToFileA\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"close\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"handleToFileA\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"...\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// error: 'handleToFileA' used after consume\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-27\",{\"children\":[\"将一个不可拷贝类型的变量赋给另一个变量时，值会发生移动。但有时你可能不想直接消费掉这个对象，只是想暂时使用一下。这就需要用到“借用”了，可以通过将一个方法标记为 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"borrowing\"}],\" 来实现：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-7\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"struct\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"~\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Copyable\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  borrowing \"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"token omit\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"_\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" data\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Data\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement30\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement31\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement32\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement33\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement34\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement35\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement36\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement38\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement39\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// It's ok to do this multiple times:\"]}],[\"$\",\"span\",\"code-segement40\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement41\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"handleToFileA\"]}],[\"$\",\"span\",\"code-segement42\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement43\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement44\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement45\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"...\"]}],[\"$\",\"span\",\"code-segement46\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement47\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement48\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"handleToFileA\"]}],[\"$\",\"span\",\"code-segement49\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement50\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement51\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement52\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"...\"]}],[\"$\",\"span\",\"code-segement53\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement54\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement55\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"handleToFileA\"]}],[\"$\",\"span\",\"code-segement56\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\".\"]}],[\"$\",\"span\",\"code-segement57\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"write\"]}],[\"$\",\"span\",\"code-segement58\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement59\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"...\"]}],[\"$\",\"span\",\"code-segement60\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-28\",{\"children\":[\"实际上你并不需要显式的 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"close\"}],\" 方法，不可拷贝类型由于有 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"deinit\"}],\" 方法，你可以直接在那里释放资源，从而实现类似 RAII 的效果：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-8\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"struct\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"~\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"Copyable\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement14\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"deinit\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// Called when the file descriptor leaves the scope.\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement22\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"    \"]}],[\"$\",\"span\",\"code-segement23\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement24\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement25\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement26\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}],[\"$\",\"span\",\"code-segement27\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement28\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement29\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-29\",{\"children\":[\"方法如果有 \",[\"$\",\"code\",null,{\"className\":\"$undefined\",\"children\":\"consuming\"}],\" 的参数，同样也会取走这个变量的所有权：\"]}],\"\\n\",[\"$\",\"pre\",\"pre-9\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"flushAndClose\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"token omit\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"_\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" fd\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" consuming \"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// ...\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],\"\\n\",[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// `deinit` of `fd` is called here.\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"p\",\"p-30\",{\"children\":\"你不能够取走借用变量的所有权：\"}],\"\\n\",[\"$\",\"pre\",\"pre-10\",{\"children\":[\"$\",\"pre\",null,{\"className\":\"text-sm\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\",\"padding\":\"1em\",\"margin\":\"0.5em 0\",\"overflow\":\"auto\",\"borderRadius\":\"0.3em\"},\"children\":[\"$\",\"code\",null,{\"className\":\"language-swift\",\"style\":{\"background\":\"hsl(230, 1%, 98%)\",\"color\":\"hsl(230, 8%, 24%)\",\"fontFamily\":\"\\\"Fira Code\\\", \\\"Fira Mono\\\", Menlo, Consolas, \\\"DejaVu Sans Mono\\\", monospace\",\"direction\":\"ltr\",\"textAlign\":\"left\",\"whiteSpace\":\"pre\",\"wordSpacing\":\"normal\",\"wordBreak\":\"normal\",\"lineHeight\":\"1.5\",\"MozTabSize\":\"2\",\"OTabSize\":\"2\",\"tabSize\":\"2\",\"WebkitHyphens\":\"none\",\"MozHyphens\":\"none\",\"msHyphens\":\"none\",\"hyphens\":\"none\"},\"children\":[false,[[\"$\",\"span\",\"code-segement0\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(301, 63%, 40%)\"},\"children\":[\"func\"]}],[\"$\",\"span\",\"code-segement1\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement2\",{\"className\":\"token function-definition\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"appendSomething\"]}],[\"$\",\"span\",\"code-segement3\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement4\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"to fd\"]}],[\"$\",\"span\",\"code-segement5\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\":\"]}],[\"$\",\"span\",\"code-segement6\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" borrowing \"]}],[\"$\",\"span\",\"code-segement7\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(35, 99%, 36%)\"},\"children\":[\"FileDescriptor\"]}],[\"$\",\"span\",\"code-segement8\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement9\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement10\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"{\"]}],[\"$\",\"span\",\"code-segement11\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement12\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"  \"]}],[\"$\",\"span\",\"code-segement13\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(221, 87%, 60%)\"},\"children\":[\"flushAndClose\"]}],[\"$\",\"span\",\"code-segement14\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"(\"]}],[\"$\",\"span\",\"code-segement15\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"fd\"]}],[\"$\",\"span\",\"code-segement16\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\")\"]}],[\"$\",\"span\",\"code-segement17\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\" \"]}],[\"$\",\"span\",\"code-segement18\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 4%, 64%)\",\"fontStyle\":\"italic\"},\"children\":[\"// error: 'fd' has guaranteed ownership but was consumed\"]}],[\"$\",\"span\",\"code-segement19\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\\n\"]}],[\"$\",\"span\",\"code-segement20\",{\"className\":\"$undefined\",\"style\":{},\"children\":[\"\"]}],[\"$\",\"span\",\"code-segement21\",{\"className\":\"token\",\"style\":{\"color\":\"hsl(230, 8%, 24%)\"},\"children\":[\"}\"]}]]]}]}]}],\"\\n\",[\"$\",\"h2\",\"h2-5\",{\"children\":\"总结\"}],\"\\n\",[\"$\",\"p\",\"p-31\",{\"children\":\"所有权是一个非常棒的特性，它能够让我们写出更加内存安全的代码，同时又不需要引入额外的开销。我们称这类特性为零开销抽象，它们在系统编程中至关重要。尽管 Swift 没有强制要求我们使用所有权特性，但我们仍然应该了解它，并尽可能利用它写出更好的代码。\"}]]}]}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"为什么所有权很重要 | Zilong Zhou\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"A statically generated blog example using Next.js and Zilong Zhou.\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"为什么所有权很重要 | Zilong Zhou\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"A statically generated blog example using Next.js and Zilong Zhou.\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/assets/blog/preview/cover.jpg\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:title\",\"content\":\"为什么所有权很重要 | Zilong Zhou\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:description\",\"content\":\"A statically generated blog example using Next.js and Zilong Zhou.\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/assets/blog/preview/cover.jpg\"}],[\"$\",\"meta\",\"11\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>